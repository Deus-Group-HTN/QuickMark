<!DOCTYPE html>
<html lang="en">
   <head>
      <title>QuickMark</title>
      <meta charset="utf-8">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
      <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
      <meta property="og:title" content="QuickMark" />
      <meta property="og:type" content="website" />
      <meta property="og:url" content="https://quickmark.victorwei.com" />
      <meta property="og:image" content="https://quickmark.victorwei.com/content.png" />
      <meta property="og:description" content="MARK EASY" />
      <meta name="keywords" content="HTML, CSS, JavaScript, Three.js">
      <meta name="author" content="Deus Group">
      <style>
         body {font-family: sans-serif, "Times New Roman", Georgia, Serif;}
         h1, h2, h3, h4, h5, h6 {
         font-family: sans-serif;
         }
         body {
         background-color: #ffffff;
         font-family: sans-serif;
         }
         .item {
         display: inline-block;
         }
         .individual-question {
         display: block;
         }
         #bodysection {
         padding-left: 3%;
         padding-bottom: 3%;
         }
      </style>
      <link rel="stylesheet" href="./css/owl.carousel.css">
      <link rel="stylesheet" href="./css/owl.theme.default.css">
   	</head>
   	<body>
      <!-- Navbar (sit on top) -->
      <div class="w3-top">
         <div class="w3-bar w3-white w3-padding w3-card" style="letter-spacing:3px;">
            <a href="#home" class="w3-bar-item w3-button">QuickMark.</a>
            <!-- Right-sided navbar links. Hide them on small screens -->
            <div class="w3-right w3-hide-small">
               <a href="#about" class="w3-bar-item w3-button">About</a>
               <a href="#menu" class="w3-bar-item w3-button">Menu</a>
               <a href="#contact" class="w3-bar-item w3-button">Contact</a>
            </div>
         </div>
      </div>
      <br><br><br>
      <center>
         <h1 style="font-family: sans-serif;">QuickMark.</h1>
      </center>
      <div id="bodysection">
         <div id="upload_section">
            <h2>Upload Tests Section</h2>
            <br><label>Choose A File: </label><input type="file" id="siofu_input" multiple><br/>
            <br><label>Upload Progress: </label><progress id="upload_progress" value="0" max="100"> 0% </progress>
         </div>
         <br><br>
         <div id="marking_section">
            <h2>Mark Tests Section</h2>
            <h3 id="currentStudent"></h3>
            <div id="owl-demo" class="owl-carousel owl-theme">
            </div>
            <label>Score: </label><input id="score" type="text"><br><br>
            <!-- <label>Comments: </label>
            <textarea id="comment" rows="4" cols="50"></textarea> -->
            <br>
            <br>
            <button id="submit_score">Submit</button>

            <br>
            <br>

            <button id="prev_question">Previous Question</button>
            <button id="next_question">Next Question</button>
         </div>
         <br><br>
         <div id="score_section">
            <h2>View Student Scores Section</h2>
         </div>
      </div>
      <!-- Load Resources -->
      <script src="javascripts/socket.io.js"></script>
      <script src="javascripts/jquery.js"></script>
      <script src="javascripts/owl.carousel.js"></script>
      <script src="javascripts/client.js"></script>
      <script>
         /*
         
         	UPLOAD TESTS SECTION
         
         */
        var socket = io.connect();
        var uploader = new SocketIOFileUpload(socket);
        uploader.listenOnInput(document.getElementById("siofu_input"));
        var numberOfFiles = 0;

        // Choose event

        uploader.addEventListener("choose", function (event) {
        	numberOfFiles = event.files.length;
        })
         
        // Start event
         
        uploader.addEventListener("start", function (event) {
        	console.log(event)
        	console.log("Starting upload", event.file.name)
        })
         
        // Progress event
         
        uploader.addEventListener("progress", function (event) {
         	var percentage = event.bytesLoaded / event.file.size * 100;
         	$("#upload_progress").val(percentage)
        })
        
        // Complete Event
        
        var updateId;
         
        uploader.addEventListener('complete', function (event) {
        	console.log("Completed upload", event.file.name)

        })
         
        uploader.addEventListener('error', function (event) {
        	console.log("Error upload", event.file.name)
        })
         
        
        /*
         
         	MARKING SECTION
         
        */
        
        let students = [];
        let numberOfQuestions = 0;

        let owl = $(".owl-carousel");

        owl.owlCarousel({
           	center: true,
     	    loop:false,
     	    nav:true,
     	    items: 2,
     	    margin: 50
       	});
         
        socket.on('files', function (data) {
        	console.log("Received", data.name, "files")

        	students.push({
        		name: data.name,
        		files: data.files,
        		score: [],
        		comments: []
        	})
        	console.log(students.length)
        	if (students.length == numberOfFiles) {
        		numberOfQuestions = data.files.length;
        		displayQuestion(1);
        	}
        })

        function displayQuestion(questionNumber) {

        	for (var i=0; i<100; i++) {
			   $(".owl-carousel").trigger('remove.owl.carousel', [i]).trigger('refresh.owl.carousel');
			}

        	for (let student of students) {
        		let studentAnswers = student.files;

        		let path = "./questions/" + student.name + "/" + studentAnswers[questionNumber-1];
         		let content = "<img class='individual-question' src=" + path + ">"
        		$('.owl-carousel').trigger('add.owl.carousel', [content]).trigger('update.owl.carousel').trigger('refresh.owl.carousel');
        	}

         	/*for (let file of data.files) {
         		let path = "./questions/" + data.name + "/" + file;
         		let content = "<img class='individual-question' src=" + path + ">"

         		$('.owl-carousel').trigger('add.owl.carousel', [content]).trigger('update.owl.carousel')
         	}*/
        }
        
        $(window).keyup(function (event) {    
         
            // handle cursor keys
            if (event.keyCode == 37) {
                // go left
                owl.trigger('prev.owl.carousel');
            } else if (event.keyCode == 39) {
                // go right
                owl.trigger('next.owl.carousel');
            }
         
        });
         
        let currQuestion = 1;
         
        $("#score").keyup(function (event) {
         	if (event.keyCode == 13) {

         		students[currStudent].score[currQuestion-1] = parseInt($("#score").val())

         		console.log("Gave a score of",$("#score").val(),"to",students[currStudent].name)
         		owl.trigger('next.owl.carousel');
         		$("#score").val("")
         	}
        })
         
        owl.on('changed.owl.carousel', function (e) {
 			currStudent = e.item.index;
   		});

   		$("#next_question").click(function () {
   			if (currQuestion < numberOfQuestions) {
   				console.log("Moving to question", currQuestion+1)
   				currQuestion += 1;
   				displayQuestion(currQuestion)
   			}
   		})

   		$("#prev_question").click(function () {
   			if (currQuestion > 0) {
   				console.log("Moving to question", currQuestion-1)
   				currQuestion -= 1;
   				displayQuestion(currQuestion)
   			}
   		})
 
         
        /*
         
         	VIEW SCORE SECTION
         
        */
         
         
      </script>
   </body>
</html>